
\chapter{应用层}

\section{网络应用模型}

\subsection{C/S模型}
客户/服务器模型。

\subsubsection{特点}
\begin{itemize}
    \item 客户、服务器地位不平等
    \item 客户之间不直接通信
    \item 服务器损害则影响全局
    \item 服务器负载大
\end{itemize}


\subsection{P2P模型}
\begin{itemize}
    \item 主机之间直接通信
    \item 主机之间地位平等
    \item 单个节点损害不影响全局
    \item 各节点可分摊负载
\end{itemize}


\section{DNS域名系统}
DNS：将域名解析为IP地址。

\subsection{域名}
www（三级域名）.baidu（二级域名）.com（顶级域名）

\begin{enumerate}
    \item 根域名
    \item 顶级域名：\begin{itemize}
        \item 国家顶级域名：cn、us、uk
        \item 通用顶级域名：com、net、org
        \item 基础结构域名/反向域名：arpa
    \end{itemize}
    \item 二级域名：\begin{itemize}
        \item 类别域名：ac、com、edu、net、org、gov
        \item 行政域名：js、bj，用于省、自治区、直辖市
    \end{itemize}
    \item 三级域名
    \item 四级域名
\end{enumerate}


\subsection{域名服务器}
\begin{enumerate}
    \item 根域名服务器：
    \item 顶级域名服务器：管理服务器注册的所有二级域名
    \item 权限域名服务器：负责一个区的域名服务器
    \item 本地域名服务器：主机发送DNS查询请求时，查询请求报文交给本地域名服务器；
\end{enumerate}


\subsection{域名解析过程}

\begin{itemize}
    \item 递归查询：若主机所询问的本地域名服务器不知道被查询域名的IP地址，那么本地域名服务器以DNS客户的身份，向其他根域名服务器继续发出查询请求报文。这种方法主机用户和本地域名服务器发送的域名请求条数均为1条。
    \item 迭代查询：
\end{itemize}


\section{FTP}
\textbf{文件传送协议}。提供不同种类主机系统之间文件传输能力。
\begin{itemize}
    \item 基于C/S。
    \item 依照FTP，提供服务，进行文件传送的计算机是\textbf{FTP服务器}。
    \item 连接FTP服务器，依照FTP进行文件传送的计算机是\textbf{FTP客户端}。
\end{itemize}

\subsection{原理}

使用TCP实现可靠传输。TCP控制连接端口21；TCP数据连接端口20。
\begin{itemize}
    \item 控制连接始终保持
    \item 数据连接间隔保持
    \item 是否使用TCP20建立数据连接与传输模式相关\begin{itemize}
        \item 主动方式使用TCP20
        \item 被动方式由客户端与服务器协商决定（端口>1024）
    \end{itemize}
\end{itemize}

\subsubsection{登录}
FTP地址：用户名\&密码

\paragraph{匿名登录}


\subsection{传输模式}
\begin{enumerate}
    \item 文本模式：ASCII，以文本序列传输数据
    \item 二进制模式：Binary，以二进制序列传输数据
\end{enumerate}


\subsection{TFTP简单文件传送协议}


\section{Email}

\subsection{格式}


\subsection{组成结构}

基于C/S。发送方\(\xrightarrow{\text{STMP}}\)发送方服务器\(\xrightarrow{\text{STMP}}\)接收方服务器\(\xrightarrow{\text{POP3}}\)接收方

\subsubsection{用户代理}
电子邮件客户端，使用\textbf{SMTP协议}向发送方邮件服务器发送邮件，使用\textbf{TCP连接}。

\subparagraph{功能}
\begin{itemize}
    \item 处理
    \item 显示
    \item 撰写
    \item 通信
\end{itemize}

\subsubsection{邮件服务器}

\begin{itemize}
    \item 发送方邮件服务器使用\textbf{SMTP协议}向接收方邮件服务器发送邮件；使用\textbf{TCP连接}
    \item 接收方邮件服务器使用\textbf{POP3协议}让收件人读取邮件；使用\textbf{TCP连接}
\end{itemize}


\subparagraph{功能}
\begin{itemize}
    \item 发送\&接收邮件
    \item 向发件人报告结果
\end{itemize}


\subsection{SMTP}
简单邮件传送协议。

规定两个相互通信的STMP进程之间如何交换信息。
\begin{itemize}
    \item 负责发送邮件的进程是STMP客户端
    \item 负责接收邮件的进程是STMP服务器
\end{itemize}

规定了14条命令和21种应答信息。

使用TCP连接，端口号25，基于C/S。

三个阶段：\begin{enumerate}
    \item 建立连接
    \item 邮件传送
    \item 释放连接
\end{enumerate}

\subsubsection{缺点}
\begin{itemize}
    \item 不能传送可执行文件和二进制对象
    \item 仅传送7位ASCII码，不能传送非英语文字。
    \item 拒绝超过一定长度的邮件
\end{itemize}


\subsection{MIME}
通用因特网邮件扩充。

使传输内容丰富，将非ASCII码转化为7位ASCII码。


\subsection{POP3}
邮局协议。TCP连接，端口号110，C/S。

\subsubsection{工作方式}
\begin{itemize}
    \item 下载并保留（在服务器）
    \item 下载并删除
\end{itemize}


\subsection{IMAP}
网际报文存取协议。比POP3复杂，用户打开IMAP服务器时，只能看到首部；打开邮件时才上传到用户计算机。

允许只读邮件的某一部分。


\subsection{基于万维网的电子邮件}
用户发送、读取邮件使用http，邮件服务器发送使用SMTP。


\section{WWW}
万维网。

\subsection{浏览器访问网页的过程}

\begin{enumerate}
    \item 用户输入网址（域名）
    \item 通过DNS服务器查询域名对应IP地址，浏览器将查询结果“域名->IP”缓存到本地
    \item 浏览器与<Web服务器IP地址：80端口>建立TCP连接
    \item 服务器在第三次握手中携带HTTP请求报文，指明访问哪个html网页
    \item 服务器返回HTTP响应报文，携带html文件
    \item 若html引用其他n个元素，还需n组http请求\&响应，持续、非持续
\end{enumerate}


\section{HTTP协议}
超文本传输协议。

工作方式分为持续、非持续。1.0默认非持续；1.1默认持续。
\begin{itemize}
    \item HTTP请求报文通常较小，可忽略TCP报文段的传输时延。
    \item HTPP响应报文通常较大，需考虑TCP报文段的传输时延。
\end{itemize}

\subsection{非持续连接}
可以使用并行TCP连接加快获取html后几个网页元素的速度。

第一次TCP连接返回html后断开连接。浏览器解析后若还要引用其他元素，需分别建立一次TCP连接。

在挥手未完全释放连接时，可迅速建立下一个连接，此时每请求一个文件至少2RTT。


\subsection{持续连接}
分为流水线、非流水线。完成后TCP连接可多保持一段时间，由Web服务器设置持续时间参数。

\subsubsection{流水线}
浏览器解析后若还要引用其他元素，需分别发送HTTP请求、响应报文。


\subsubsection{非流水线}
浏览器解析后若还要引用其他元素，可连续发送HTTP请求，随后服务器连续响应。


\subsection{报文格式}

\subparagraph{请求报文}
\begin{itemize}
    \item Connection\begin{itemize}
        \item close：非持续
        \item keep-alive：持续
    \end{itemize}
\end{itemize}

\subparagraph{响应报文}


\subsection{Cookie}

\begin{itemize}
    \item HTTP请求POST
    \item 生成Cookie，存储在服务器，相当于临时证件
    \item HTTP响应，携带Cookie
    \item 浏览器将Cookie缓存到本地
    \item 后续HTTP请求，携带Cookie
    \item 通过Cookie识别客户端
\end{itemize}

